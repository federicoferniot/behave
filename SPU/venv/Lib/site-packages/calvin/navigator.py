"""
Navigator module.
"""
from selenium.common.exceptions import NoSuchElementException
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

_DEFAULT_TIMEOUT = 4
class Navigator:
    def __init__(self, driver):
        """
        Class that help navigate between tabs and windows.
        """
        self.driver = driver

    def close_all(self):
        """
        Close the driver completly.
        """
        all_tabs = self.driver.window_handles
        for tab in all_tabs:
            self.driver.switch_to.window(tab)
            self.driver.close()

    def navigate_url(self, url, position=1):
        """
        Navigate between tabs/windows with partial url.

        :param url: Partial url to navigate.
        :param position: Position of tab/window.
        """
        all = self.driver.window_handles
        position -=1
        current_window = self.driver.current_window_handle
        for window in all:
            self.driver.switch_to.window(window)
            if url in self.driver.current_url:
                if position <= 0:
                    return
                position -= 1
        self.driver.switch_to.window(current_window)
        raise NoSuchElementException("La pestaña/ventana no existe")

    def navigate_full_url(self, url,position=1):
        """
        Navigate between tabs/windows with full url.

        :param url: Partial url to navigate.
        :param position: Position of tab/window.
        """
        all = self.driver.window_handles
        position -=1
        current_window = self.driver.current_window_handle
        for window in all:
            self.driver.switch_to.window(window)
            if url == self.driver.current_url:
                if position <=0:
                    return
                position -= 1
        self.driver.switch_to.window(current_window)
        raise NoSuchElementException("La pestaña/ventana no existe")

    def navigate_position(self, position=0):
        """
        Navigate between tabs/windows with position.

        :param position: Position of tab/window.
        """
        all = self.driver.window_handles
        if len(all) > position >= 0:
            self.driver.switch_to.window(all[position])
            return
        else:
            raise NoSuchElementException("La pestaña/ventana no existe")

    def wait_until_new_window_is_charge(self, time_max=_DEFAULT_TIMEOUT):
        """
        Wait until the new tab/window will is charge.

        :param time_max: Time max to wait.
        """
        wait = WebDriverWait(self.driver, time_max)
        wait.until(EC.new_window_is_opened(self.driver.window_handles))

    def wait_until_new_window_is_opened(self, time_max=_DEFAULT_TIMEOUT):
        """
        Wait until new tab/window will is opened.

        :param time_max: Time max to wait.
        """
        number_of_windows = self.driver.window_handles
        wait = WebDriverWait(self.driver, time_max)
        wait.until(EC.number_of_windows_to_be(number_of_windows))
